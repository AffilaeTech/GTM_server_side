___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Affilae - Server Side",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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\u003d\u003d"
  },
  "description": "Collect clickId from redirection.\nPersist clickId.\nPostback conversion.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "aeKey",
    "displayName": "Key",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "conversionId",
    "displayName": "conversionId",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "conversionTotal",
    "displayName": "conversionTotal",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "conversionCurrency",
    "displayName": "conversionCurrency",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "voucher",
    "displayName": "voucher",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "productId",
    "displayName": "productId",
    "simpleValueType": true
  },
  {
    "type": "TEXT",
    "name": "conversionSubId",
    "displayName": "conversionSubId",
    "simpleValueType": true
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const getRequestHeader = require('getRequestHeader');
const encodeUriComponent = require('encodeUriComponent');
const getCookieValues = require('getCookieValues');
const sendHttpRequest = require('sendHttpRequest');
const setCookie = require('setCookie');
const parseUrl = require('parseUrl');
const getAllEventData = require('getAllEventData');
const eventData = getAllEventData();
const eventName = eventData.event_name;

const AFFILAE_TRACKING = 'https://lb.affilae.com/';

switch (eventName) {
    case 'page_view':
        const url = getRequestHeader('referer');
        if (url) {
            const searchParams = parseUrl(url).searchParams;
            if (searchParams.aecid) {
                const cookieValue = getCookieValues('_ae_cid')[0] || null;
                const clickIds = (cookieValue) ? cookieValue + '-' + searchParams.aecid : searchParams.aecid;
                const options = {
                    'domain': 'auto',
                    'path': '/',
                    'secure': true,
                    'httpOnly': true,
                    'max-age': 2592000, // 30 days in seconds
                };
                setCookie('_ae_cid', clickIds, options, false);
            }
        }
        data.gtmOnSuccess();
        break;
    case 'purchase':
        const aecid = getCookieValues('_ae_cid')[0] || '';
        if (aecid) {
            let requestUrl = AFFILAE_TRACKING + '?key=' + encode(data.aeKey);
            requestUrl = requestUrl + '&id=' + encode(data.conversionId);
            requestUrl = requestUrl + '&amount=' + encode(data.conversionTotal);
            requestUrl = requestUrl + '&cv=' + encode(data.conversionSubId);
            requestUrl = requestUrl + '&payment=' + encode(data.conversionPayment);
            requestUrl = requestUrl + '&voucher=' + encode(data.voucher);
            requestUrl = requestUrl + '&product=' + encode(data.productId);
            requestUrl = requestUrl + '&currency=' + encode(data.conversionCurrency);
            requestUrl = requestUrl + '&cids=' + encode(aecid);

            sendHttpRequest(requestUrl,
                (statusCode, headers, body) => {
                    if (statusCode === 200) {
                        data.gtmOnSuccess();
                    } else {
                        data.gtmOnFailure();
                    }
                },
                {method: 'GET'}
            );
        } else {
            data.gtmOnSuccess();
        }
        break;
    default:
        data.gtmOnSuccess();
        break;
}

function encode(data) {
    data = data || '';
    return encodeUriComponent(data);
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "get_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "cookieAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "cookieNames",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "_ae_cid"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "set_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedCookies",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "name"
                  },
                  {
                    "type": 1,
                    "string": "domain"
                  },
                  {
                    "type": 1,
                    "string": "path"
                  },
                  {
                    "type": 1,
                    "string": "secure"
                  },
                  {
                    "type": 1,
                    "string": "session"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_ae_cid"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 07/07/2023, 11:16:23


